
### 1. å‹å®šç¾©ï¼ˆã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰

#### `lib/types.ts`
```typescript
// ============================================
// å‹å®šç¾©
// ============================================

export type ApplicationStatus = 'ç”³è«‹ä¸­' | 'æ‰¿èªæ¸ˆ' | 'å´ä¸‹';
export type CheckStatus = 'æœªç¢ºèª' | 'çµŒç†æ‰¿èªæ¸ˆ' | 'å·®ã—æˆ»ã—' | 'å½¹å“¡ç¢ºèªå¾…ã¡' | 'æœ€çµ‚æ‰¿èªæ¸ˆ';
export type AIRiskLevel = 'OK' | 'WARNING' | 'ERROR';

export interface Application {
  applicationId: string;
  applicationDate: string;
  employeeNumber: string;
  employeeName: string;
  location: string;
  tool: string;
  amount: number;
  targetMonth: string;
  purpose: string;
  receiptUrl: string;
  creditUrl?: string;
  status: ApplicationStatus;
  checkStatus: CheckStatus;
  
  // AIè‡ªå‹•ãƒã‚§ãƒƒã‚¯çµæœ
  aiCheckResult?: AICheckResult;
  aiRiskLevel?: AIRiskLevel;
  
  // çµŒç†ãƒã‚§ãƒƒã‚¯
  accountingChecker?: string;
  accountingCheckDate?: string;
  accountingComment?: string;
  
  // å½¹å“¡ç¢ºèª
  executiveApprover?: string;
  executiveApprovalDate?: string;
  executiveComment?: string;
  
  supervisor?: string;
}

export interface AICheckResult {
  extractedAmount: number;
  extractedDate: string;
  extractedVendor: string;
  amountMatch: boolean;
  dateMatch: boolean;
  vendorMatch: boolean;
  riskLevel: AIRiskLevel;
  findings: string[];
  recommendation: string;
  confidence: number;
}

export interface FilterOptions {
  searchQuery?: string;
  aiRiskLevel?: AIRiskLevel | 'all';
  checkStatus?: CheckStatus | 'all';
}

export interface CheckSubmitPayload {
  applicationId: string;
  action: 'accounting_approve' | 'accounting_reject' | 'send_to_executive' | 'executive_approve' | 'executive_reject';
  checker: string;
  comment?: string;
}
```

---

### 2. å®šæ•°å®šç¾©ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

#### `lib/constants.ts`
```typescript
// ============================================
// å®šæ•°å®šç¾©
// ============================================

export const CHECK_STATUS = {
  UNCONFIRMED: 'æœªç¢ºèª',
  ACCOUNTING_APPROVED: 'çµŒç†æ‰¿èªæ¸ˆ',
  REJECTED: 'å·®ã—æˆ»ã—',
  EXECUTIVE_PENDING: 'å½¹å“¡ç¢ºèªå¾…ã¡',
  EXECUTIVE_APPROVED: 'æœ€çµ‚æ‰¿èªæ¸ˆ',
} as const;

export const AI_RISK_LEVEL = {
  OK: 'OK',
  WARNING: 'WARNING',
  ERROR: 'ERROR',
} as const;

export const LOCATIONS = [
  'å¤©ç¥',
  'ä¸­æ´²',
  'ç†Šæœ¬',
  'ä¹å¤§',
  'ç›®é»’',
] as const;

export const CHECK_STATUS_COLORS = {
  [CHECK_STATUS.UNCONFIRMED]: 'bg-gray-100 text-gray-800 border-gray-300',
  [CHECK_STATUS.ACCOUNTING_APPROVED]: 'bg-green-100 text-green-800 border-green-300',
  [CHECK_STATUS.REJECTED]: 'bg-red-100 text-red-800 border-red-300',
  [CHECK_STATUS.EXECUTIVE_PENDING]: 'bg-blue-100 text-blue-800 border-blue-300',
  [CHECK_STATUS.EXECUTIVE_APPROVED]: 'bg-emerald-100 text-emerald-800 border-emerald-300',
} as const;

export const AI_RISK_COLORS = {
  [AI_RISK_LEVEL.OK]: 'bg-green-50 text-green-700 border-green-200',
  [AI_RISK_LEVEL.WARNING]: 'bg-yellow-50 text-yellow-700 border-yellow-200',
  [AI_RISK_LEVEL.ERROR]: 'bg-red-50 text-red-700 border-red-200',
} as const;

export const AI_RISK_LABELS = {
  [AI_RISK_LEVEL.OK]: 'âœ… AIæ‰¿èª',
  [AI_RISK_LEVEL.WARNING]: 'âš ï¸ è¦ç¢ºèª',
  [AI_RISK_LEVEL.ERROR]: 'âŒ ä¸ä¸€è‡´æ¤œå‡º',
} as const;

// æœˆã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ç”¨
export function getCurrentTargetMonth(): string {
  const now = new Date();
  // ä»Šæœˆ1æ—¥ã‹ã‚‰15æ—¥ã¾ã§ â†’ å…ˆæœˆåˆ†ã‚’è¡¨ç¤º
  // ä»Šæœˆ16æ—¥ä»¥é™ â†’ ä»Šæœˆåˆ†ã‚’è¡¨ç¤º
  if (now.getDate() <= 15) {
    const prev = new Date(now.getFullYear(), now.getMonth() - 1, 1);
    return `${prev.getFullYear()}-${String(prev.getMonth() + 1).padStart(2, '0')}`;
  } else {
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
  }
}
```

---

### 3. ãƒ¡ã‚¤ãƒ³ç”»é¢

#### `app/page.tsx`
```typescript
'use client';

import { useState, useEffect } from 'react';
import { Header } from '@/components/layout/Header';
import { TwoColumnLayout } from '@/components/layout/TwoColumnLayout';
import { LeftPanel } from '@/components/approval/LeftPanel';
import { RightPanel } from '@/components/approval/RightPanel';
import { useApplications } from '@/hooks/useApplications';
import { getCurrentTargetMonth } from '@/lib/constants';
import { Application } from '@/lib/types';

export default function ApprovalPage() {
  const [targetMonth, setTargetMonth] = useState(getCurrentTargetMonth());
  const [selectedApplicationId, setSelectedApplicationId] = useState<string | null>(null);
  
  const { applications, isLoading, error, refetch } = useApplications(targetMonth);
  
  const selectedApplication = applications.find(
    app => app.applicationId === selectedApplicationId
  );
  
  // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«æœ€åˆã®ç”³è«‹ã‚’é¸æŠ
  useEffect(() => {
    if (applications.length > 0 && !selectedApplicationId) {
      setSelectedApplicationId(applications[0].applicationId);
    }
  }, [applications, selectedApplicationId]);
  
  const handleMonthChange = (month: string) => {
    setTargetMonth(month);
    setSelectedApplicationId(null);
  };
  
  const handleSelectApplication = (app: Application) => {
    setSelectedApplicationId(app.applicationId);
  };
  
  const handleCheckSubmitted = () => {
    refetch();
  };
  
  return (
    <div className="h-screen flex flex-col bg-gray-50">
      <Header 
        targetMonth={targetMonth}
        onMonthChange={handleMonthChange}
        applications={applications}
      />
      
      <TwoColumnLayout
        left={
          <LeftPanel
            applications={applications}
            selectedId={selectedApplicationId}
            onSelect={handleSelectApplication}
            isLoading={isLoading}
            error={error}
          />
        }
        right={
          <RightPanel
            application={selectedApplication}
            onCheckSubmitted={handleCheckSubmitted}
          />
        }
      />
    </div>
  );
}
```

---

### 4. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### `components/layout/Header.tsx`
```typescript
'use client';

import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Download } from 'lucide-react';
import { getMonthOptions, formatMonthYear } from '@/lib/utils';
import { exportToCSV } from '@/lib/formatters';
import { Application } from '@/lib/types';

interface HeaderProps {
  targetMonth: string;
  onMonthChange: (month: string) => void;
  applications: Application[];
}

export function Header({ targetMonth, onMonthChange, applications }: HeaderProps) {
  const monthOptions = getMonthOptions(12);
  
  const handleExport = () => {
    const csv = exportToCSV(applications);
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ç”³è«‹ä¸€è¦§_${targetMonth}.csv`;
    link.click();
  };
  
  return (
    <header className="bg-white border-b border-gray-200 px-6 py-4">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <h1 className="text-2xl font-bold text-gray-900">
            æ¥­å‹™ãƒ„ãƒ¼ãƒ«ç«‹æ›¿ç”³è«‹ æ‰¿èªã‚·ã‚¹ãƒ†ãƒ 
          </h1>
          
          <Select value={targetMonth} onValueChange={onMonthChange}>
            <SelectTrigger className="w-[180px]">
              <SelectValue placeholder="å¯¾è±¡æœˆã‚’é¸æŠ" />
            </SelectTrigger>
            <SelectContent>
              {monthOptions.map(opt => (
                <SelectItem key={opt.value} value={opt.value}>
                  {opt.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        
        <div className="flex items-center gap-3">
          <Button
            variant="outline"
            onClick={handleExport}
            disabled={applications.length === 0}
          >
            <Download className="h-4 w-4 mr-2" />
            CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </Button>
        </div>
      </div>
    </header>
  );
}
```

#### `components/layout/TwoColumnLayout.tsx`
```typescript
import { ReactNode } from 'react';

interface TwoColumnLayoutProps {
  left: ReactNode;
  right: ReactNode;
}

export function TwoColumnLayout({ left, right }: TwoColumnLayoutProps) {
  return (
    <div className="flex-1 flex overflow-hidden">
      {/* å·¦ãƒ‘ãƒãƒ«: ç”³è«‹ä¸€è¦§ */}
      <div className="w-96 border-r border-gray-200 bg-white overflow-y-auto">
        {left}
      </div>
      
      {/* å³ãƒ‘ãƒãƒ«: è©³ç´° */}
      <div className="flex-1 overflow-y-auto bg-gray-50">
        {right}
      </div>
    </div>
  );
}
```

---

### 5. å·¦ãƒ‘ãƒãƒ«ï¼ˆç”³è«‹ä¸€è¦§ï¼‰

#### `components/approval/LeftPanel.tsx`
```typescript
'use client';

import { useState } from 'react';
import { ApplicationList } from './ApplicationList';
import { Input } from '@/components/ui/input';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Search } from 'lucide-react';
import { Application, FilterOptions } from '@/lib/types';
import { LoadingSpinner } from '@/components/shared/LoadingSpinner';
import { EmptyState } from '@/components/shared/EmptyState';

interface LeftPanelProps {
  applications: Application[];
  selectedId: string | null;
  onSelect: (app: Application) => void;
  isLoading: boolean;
  error: Error | null;
}

export function LeftPanel({ applications, selectedId, onSelect, isLoading, error }: LeftPanelProps) {
  const [filters, setFilters] = useState<FilterOptions>({
    searchQuery: '',
    aiRiskLevel: 'all',
    checkStatus: 'all',
  });
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  const filteredApplications = applications.filter(app => {
    if (filters.searchQuery) {
      const query = filters.searchQuery.toLowerCase();
      if (
        !app.employeeName.toLowerCase().includes(query) &&
        !app.tool.toLowerCase().includes(query)
      ) {
        return false;
      }
    }
    
    if (filters.aiRiskLevel !== 'all' && app.aiRiskLevel !== filters.aiRiskLevel) {
      return false;
    }
    
    if (filters.checkStatus !== 'all' && app.checkStatus !== filters.checkStatus) {
      return false;
    }
    
    return true;
  });
  
  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-full">
        <LoadingSpinner />
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="p-6">
        <EmptyState
          icon="âš ï¸"
          title="ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
          description={error.message}
        />
      </div>
    );
  }
  
  return (
    <div className="flex flex-col h-full">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="p-4 border-b border-gray-200">
        <h2 className="text-lg font-semibold text-gray-900 mb-3">
          ğŸ“‹ ç”³è«‹ä¸€è¦§ ({filteredApplications.length}ä»¶)
        </h2>
        
        {/* æ¤œç´¢ */}
        <div className="relative mb-3">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
          <Input
            placeholder="ç¤¾å“¡åãƒ»ãƒ„ãƒ¼ãƒ«åã§æ¤œç´¢..."
            value={filters.searchQuery}
            onChange={(e) => setFilters({ ...filters, searchQuery: e.target.value })}
            className="pl-10"
          />
        </div>
        
        {/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
        <div className="flex gap-2">
          <Select
            value={filters.checkStatus || 'all'}
            onValueChange={(value) => setFilters({ ...filters, checkStatus: value as any })}
          >
            <SelectTrigger className="flex-1">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">å…¨ã¦</SelectItem>
              <SelectItem value="æœªç¢ºèª">æœªç¢ºèª</SelectItem>
              <SelectItem value="çµŒç†æ‰¿èªæ¸ˆ">çµŒç†æ‰¿èªæ¸ˆ</SelectItem>
              <SelectItem value="å½¹å“¡ç¢ºèªå¾…ã¡">å½¹å“¡ç¢ºèªå¾…ã¡</SelectItem>
              <SelectItem value="æœ€çµ‚æ‰¿èªæ¸ˆ">æœ€çµ‚æ‰¿èªæ¸ˆ</SelectItem>
            </SelectContent>
          </Select>
          
          <Select
            value={filters.aiRiskLevel || 'all'}
            onValueChange={(value) => setFilters({ ...filters, aiRiskLevel: value as any })}
          >
            <SelectTrigger className="flex-1">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">AI:å…¨ã¦</SelectItem>
              <SelectItem value="OK">AI:OK</SelectItem>
              <SelectItem value="WARNING">AI:WARNING</SelectItem>
              <SelectItem value="ERROR">AI:ERROR</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>
      
      {/* ä¸€è¦§ */}
      <div className="flex-1 overflow-y-auto">
        {filteredApplications.length === 0 ? (
          <div className="p-6">
            <EmptyState
              icon="ğŸ“­"
              title="ç”³è«‹ãŒã‚ã‚Šã¾ã›ã‚“"
              description="ã“ã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç”³è«‹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
            />
          </div>
        ) : (
          <ApplicationList
            applications={filteredApplications}
            selectedId={selectedId}
            onSelect={onSelect}
          />
        )}
      </div>
    </div>
  );
}
```

#### `components/approval/ApplicationList.tsx`
```typescript
import { ApplicationListItem } from './ApplicationListItem';
import { Application } from '@/lib/types';

interface ApplicationListProps {
  applications: Application[];
  selectedId: string | null;
  onSelect: (app: Application) => void;
}

export function ApplicationList({ applications, selectedId, onSelect }: ApplicationListProps) {
  return (
    <div className="divide-y divide-gray-100">
      {applications.map(app => (
        <ApplicationListItem
          key={app.applicationId}
          application={app}
          isSelected={app.applicationId === selectedId}
          onClick={() => onSelect(app)}
        />
      ))}
    </div>
  );
}
```

#### `components/approval/ApplicationListItem.tsx`
```typescript
import { Application } from '@/lib/types';
import { AIRiskBadge } from '@/components/shared/AIRiskBadge';
import { StatusBadge } from '@/components/shared/StatusBadge';
import { formatCurrency } from '@/lib/utils';
import { cn } from '@/lib/utils';

interface ApplicationListItemProps {
  application: Application;
  isSelected: boolean;
  onClick: () => void;
}

export function ApplicationListItem({ application, isSelected, onClick }: ApplicationListItemProps) {
  return (
    <button
      onClick={onClick}
      className={cn(
        'w-full text-left p-4 hover:bg-gray-50 transition-colors',
        isSelected && 'bg-blue-50 border-l-4 border-blue-500'
      )}
    >
      <div className="flex items-start justify-between mb-2">
        <div className="font-semibold text-gray-900">
          {application.employeeName}
        </div>
        {application.aiRiskLevel && (
          <AIRiskBadge riskLevel={application.aiRiskLevel} compact />
        )}
      </div>
      
      <div className="text-sm text-gray-600 mb-2">
        {application.tool} {formatCurrency(application.amount)}
      </div>
      
      <div className="flex items-center gap-2">
        <StatusBadge status={application.checkStatus} />
      </div>
    </button>
  );
}
```

---

### 6. å³ãƒ‘ãƒãƒ«ï¼ˆè©³ç´°ï¼‰

#### `components/approval/RightPanel.tsx`
```typescript
import { Application } from '@/lib/types';
import { ApplicationDetail } from './ApplicationDetail';
import { EmptyState } from '@/components/shared/EmptyState';

interface RightPanelProps {
  application: Application | undefined;
  onCheckSubmitted: () => void;
}

export function RightPanel({ application, onCheckSubmitted }: RightPanelProps) {
  if (!application) {
    return (
      <div className="flex items-center justify-center h-full">
        <EmptyState
          icon="ğŸ‘ˆ"
          title="ç”³è«‹ã‚’é¸æŠã—ã¦ãã ã•ã„"
          description="å·¦ã®ä¸€è¦§ã‹ã‚‰ç¢ºèªã™ã‚‹ç”³è«‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„"
        />
      </div>
    );
  }
  
  return (
    <ApplicationDetail
      application={application}
      onCheckSubmitted={onCheckSubmitted}
    />
  );
}
```

#### `components/approval/ApplicationDetail.tsx`
```typescript
'use client';

import { Application } from '@/lib/types';
import { Card } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { ReceiptViewer } from './ReceiptViewer';
import { AICheckSection } from './AICheckSection';
import { AccountingCheckForm } from './AccountingCheckForm';
import { ExecutiveCheckForm } from './ExecutiveCheckForm';
import { formatCurrency, formatDate } from '@/lib/utils';
import { StatusBadge } from '@/components/shared/StatusBadge';

interface ApplicationDetailProps {
  application: Application;
  onCheckSubmitted: () => void;
}

export function ApplicationDetail({ application, onCheckSubmitted }: ApplicationDetailProps) {
  const showExecutiveCheck = application.checkStatus === 'å½¹å“¡ç¢ºèªå¾…ã¡';
  
  return (
    <div className="p-6 space-y-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <Card className="p-6">
        <div className="flex items-start justify-between mb-4">
          <div>
            <div className="text-sm text-gray-500 mb-1">ç”³è«‹ID</div>
            <div className="font-mono text-sm">{application.applicationId}</div>
          </div>
          <StatusBadge status={application.checkStatus} />
        </div>
        
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <div className="text-gray-500">ç”³è«‹æ—¥</div>
            <div className="font-medium">{formatDate(application.applicationDate)}</div>
          </div>
          <div>
            <div className="text-gray-500">ç¤¾å“¡</div>
            <div className="font-medium">{application.employeeName}</div>
          </div>
          <div>
            <div className="text-gray-500">æ‹ ç‚¹</div>
            <div className="font-medium">{application.location}</div>
          </div>
          <div>
            <div className="text-gray-500">ä¸Šé•·</div>
            <div className="font-medium">{application.supervisor || '-'}</div>
          </div>
          <div>
            <div className="text-gray-500">ãƒ„ãƒ¼ãƒ«</div>
            <div className="font-medium">{application.tool}</div>
          </div>
          <div>
            <div className="text-gray-500">é‡‘é¡</div>
            <div className="font-medium text-lg">{formatCurrency(application.amount)}</div>
          </div>
          <div className="col-span-2">
            <div className="text-gray-500">ä½¿ç”¨ç›®çš„</div>
            <div className="font-medium mt-1">{application.purpose}</div>
          </div>
        </div>
      </Card>
      
      {/* é ˜åæ›¸ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ */}
      <ReceiptViewer
        receiptUrl={application.receiptUrl}
        creditUrl={application.creditUrl}
      />
      
      {/* AIè‡ªå‹•ãƒã‚§ãƒƒã‚¯çµæœ */}
      {application.aiCheckResult && (
        <AICheckSection result={application.aiCheckResult} />
      )}
      
      <Separator />
      
      {/* çµŒç†ãƒã‚§ãƒƒã‚¯ãƒ•ã‚©ãƒ¼ãƒ  */}
      {!showExecutiveCheck && (
        <AccountingCheckForm
          application={application}
          onSubmitted={onCheckSubmitted}
        />
      )}
      
      {/* å½¹å“¡ãƒã‚§ãƒƒã‚¯ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæ¡ä»¶è¡¨ç¤ºï¼‰ */}
      {showExecutiveCheck && (
        <ExecutiveCheckForm
          application={application}
          onSubmitted={onCheckSubmitted}
        />
      )}
    </div>
  );
}
```